# å…³äº Promise çš„å­¦ä¹ ç¬”è®°

> **åšæŒï¼Œè®°ç¬”è®° ğŸ˜€, åŠ æ²¹!**

## ä¸€ã€Promise ä»‹ç»

### promise æ˜¯ä»€ä¹ˆ?

**`Promise`_['prÉ‘mÉªs]_ æ˜¯ä¸€ä¸ªå¼‚æ­¥é—®é¢˜åŒæ­¥åŒ–çš„è§£å†³æ–¹æ¡ˆ**

`Promise` å¯¹è±¡ç”¨äºè¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„æœ€ç»ˆå®Œæˆ (æˆ–å¤±è´¥)åŠå…¶ç»“æœå€¼ã€‚

ä¸€ä¸ª `Promise` å¯¹è±¡ä»£è¡¨ä¸€ä¸ªåœ¨è¿™ä¸ª `promise` è¢«åˆ›å»ºå‡ºæ¥æ—¶ä¸ä¸€å®šå·²çŸ¥çš„å€¼ã€‚å®ƒè®©æ‚¨èƒ½å¤ŸæŠŠå¼‚æ­¥æ“ä½œæœ€ç»ˆçš„æˆåŠŸè¿”å›å€¼æˆ–è€…å¤±è´¥åŸå› å’Œç›¸åº”çš„å¤„ç†ç¨‹åºå…³è”èµ·æ¥ã€‚ è¿™æ ·ä½¿å¾—å¼‚æ­¥æ–¹æ³•å¯ä»¥åƒåŒæ­¥æ–¹æ³•é‚£æ ·è¿”å›å€¼ï¼šå¼‚æ­¥æ–¹æ³•å¹¶ä¸ä¼šç«‹å³è¿”å›æœ€ç»ˆçš„å€¼ï¼Œè€Œæ˜¯ä¼šè¿”å›ä¸€ä¸ª `promise`ï¼Œä»¥ä¾¿åœ¨æœªæ¥æŸä¸ªæ—¶å€™æŠŠå€¼äº¤ç»™ä½¿ç”¨è€…ã€‚

ä¸€ä¸ª `Promise` å¿…ç„¶å¤„äºä»¥ä¸‹å‡ ç§çŠ¶æ€ä¹‹ä¸€ï¼š

- **å¾…å®šï¼ˆ_pending_ï¼‰**: åˆå§‹çŠ¶æ€ï¼Œæ—¢æ²¡æœ‰è¢«å…‘ç°ï¼Œä¹Ÿæ²¡æœ‰è¢«æ‹’ç»ã€‚
- **å·²å…‘ç°ï¼ˆ_fulfilled_ï¼‰**: æ„å‘³ç€æ“ä½œæˆåŠŸå®Œæˆã€‚
- **å·²æ‹’ç»ï¼ˆ_rejected_ï¼‰**: æ„å‘³ç€æ“ä½œå¤±è´¥ã€‚

å¾…å®šçŠ¶æ€çš„ `Promise` å¯¹è±¡è¦ä¹ˆä¼šé€šè¿‡ä¸€ä¸ªå€¼è¢«å…‘ç°ï¼ˆ_fulfilled_ï¼‰ï¼Œè¦ä¹ˆä¼šé€šè¿‡ä¸€ä¸ªåŸå› ï¼ˆé”™è¯¯ï¼‰è¢«æ‹’ç»ï¼ˆ_rejected_ï¼‰ã€‚å½“è¿™äº›æƒ…å†µä¹‹ä¸€å‘ç”Ÿæ—¶ï¼Œæˆ‘ä»¬ç”¨ `promise` çš„ `then()` æ–¹æ³•æ’åˆ—èµ·æ¥çš„ç›¸å…³å¤„ç†ç¨‹åºå°±ä¼šè¢«è°ƒç”¨ã€‚å¦‚æœ `promise` åœ¨ä¸€ä¸ªç›¸åº”çš„å¤„ç†ç¨‹åºè¢«ç»‘å®šæ—¶å°±å·²ç»è¢«å…‘ç°æˆ–è¢«æ‹’ç»äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªå¤„ç†ç¨‹åºå°±ä¼šè¢«è°ƒç”¨ï¼Œå› æ­¤åœ¨å®Œæˆå¼‚æ­¥æ“ä½œå’Œç»‘å®šå¤„ç†æ–¹æ³•ä¹‹é—´ä¸ä¼šå­˜åœ¨ç«äº‰çŠ¶æ€ã€‚

## äºŒã€Promise çš„åŸºæœ¬ä½¿ç”¨

å¯ä»¥é€šè¿‡`Promise`æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ª`Promise`å¯¹è±¡

`Promise`æ„é€ å‡½æ•°æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°çš„ä¸¤ä¸ªå‚æ•°æ˜¯`resolve`ï¼Œ`reject`ã€‚

- `resolve`å‡½æ•°çš„ä½œç”¨æ˜¯å½“`Promise`å¯¹è±¡è½¬ç§»åˆ°æˆåŠŸï¼Œ**è°ƒç”¨`resolve`å¹¶å°†æ“ä½œç»“æœä½œä¸ºå…¶å‚æ•°ä¼ é€’å‡ºå»**
- `reject`å‡½æ•°çš„ä½œç”¨æ˜¯å•`Promise`å¯¹è±¡çš„çŠ¶æ€å˜ä¸ºå¤±è´¥æ—¶ï¼Œ**å°†æ“ä½œæŠ¥å‡ºçš„é”™è¯¯ä½œä¸ºå…¶å‚æ•°ä¼ é€’å‡ºå»**

```javascript
const p = new Promise((resolve, reject) => {
  $.ajax({
    url: "http://localhost:3000/data.json",
    success: data => {
      resolve(data);
    },
    error: err => {
      reject(err);
    },
  });
});
```

å¯ä»¥ç”¨ `promise.then()`ï¼Œ`promise.catch()` å’Œ `promise.finally()` è¿™äº›æ–¹æ³•å°†è¿›ä¸€æ­¥çš„æ“ä½œä¸ä¸€ä¸ªå˜ä¸ºå·²æ•²å®šçŠ¶æ€çš„ `promise`å…³è”èµ·æ¥ã€‚è¿™äº›æ–¹æ³•è¿˜ä¼šè¿”å›ä¸€ä¸ªæ–°ç”Ÿæˆçš„ `promise` å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å¯ä»¥è¢«éå¼ºåˆ¶æ€§çš„ç”¨æ¥åš**é“¾å¼è°ƒç”¨**

```javascript
p.then(data => {
  console.log(data);
})
  .catch(err => {
    console.log(err);
  })
  .finally(() => {
    console.log("1");
  });
```

## ä¸‰ã€Promise çš„æ–¹æ³•

### 2.1 å®ä¾‹æ–¹æ³•

#### 2.1.1 `then()`

`promise` çš„ `then() `æ–¹æ³•å¸¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªå‚æ•°ï¼šæˆåŠŸå›è°ƒï¼Œå¤±è´¥å›è°ƒï¼Œå‰è¿›å›è°ƒï¼Œä¸€èˆ¬æƒ…å†µä¸‹åªéœ€è¦å®ç°ç¬¬ä¸€ä¸ªï¼Œåé¢æ˜¯å¯é€‰çš„ã€‚

```javascript
p.then(data => {
  console.log(data);
});
```

æ‰§è¡Œ `promise` çš„ `then()` æ–¹æ³•å**è¿”å›çš„ä»ç„¶æ˜¯ä¸€ä¸ª `promise` å¯¹è±¡**ï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œé“¾å¼è°ƒç”¨

#### 2.1.2 `catch()`

`Promise.prototype.catch()` ç”¨äºæ•è·é”™è¯¯ï¼Œè¡Œä¸ºä¸ `Promise.prototype.then(null, rejection)` çš„è¡Œä¸ºä¸€è‡´ï¼Œç”¨äºæŒ‡å®šå‘ç”Ÿé”™è¯¯æ—¶çš„å›è°ƒå‡½æ•°ã€‚

è€Œä¸”ï¼Œ`Promise` å¯¹è±¡çš„é”™è¯¯**å…·æœ‰â€œå†’æ³¡â€æ€§è´¨**ï¼Œä¼šä¸€ç›´å‘åä¼ é€’ï¼Œç›´åˆ°è¢«æ•è·ä¸ºæ­¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé”™è¯¯æ€»æ˜¯ä¼šè¢«ä¸‹ä¸€ä¸ª `catch` è¯­å¥æ•è·ã€‚

```javascript
p.then(data => console.log(data))
  // å¤„ç†å‰ä¸€ä¸ªå›è°ƒå‡½æ•°è¿è¡Œæ—¶å‘ç”Ÿçš„é”™è¯¯
  .catch(err => {
    console.log(err);
  });
```

#### 2.1.3 `finally()`

`finally()` æ–¹æ³•è¿”å›ä¸€ä¸ª `Promise` å¯¹è±¡ã€‚

ä¸ç®¡ promise æœ€åçš„çŠ¶æ€æ˜¯ *fulfilled* æˆ–è€…æ˜¯ *rejected*ï¼Œåœ¨æ‰§è¡Œå®Œ `then()` æˆ– `catch()` æŒ‡å®šçš„å›è°ƒå‡½æ•°ä»¥åï¼Œ**éƒ½ä¼šæ‰§è¡Œ `finally()` æ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°**ã€‚

é¿å…äº†åŒæ ·çš„è¯­å¥éœ€è¦åœ¨`then()`å’Œ`catch()`ä¸­å„å†™ä¸€æ¬¡çš„æƒ…å†µ

```javascript
p.then(data => {
  console.log(data);
})
  .catch(err => {
    console.log(err);
  })
  .finally(() => {
    console.log("finally");
  });
```

### 2.2 é™æ€æ–¹æ³•

#### 2.2.1 `Promise.resolve()`

`promise` å¹¶éä¸€å¼€å§‹å¿…é¡»å¤„äº *pending* çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨ `Promise.resolve()` **ç›´æ¥å®ä¾‹åŒ–ä¸€ä¸ªå·²ç»è§£å†³äº†ï¼ˆå¤„äº *fulfilled* çŠ¶æ€ï¼‰çš„ `promise`**

ä½¿ç”¨è¿™ä¸ªé™æ€æ–¹æ³•å¯ä»¥å°†ä»»ä½•å€¼è½¬æ¢æˆä¸€ä¸ª `promise` å€¼

```javascript
const p_fulfilled = Promise.resolve(1);
setTimeout(console.log, 0, p_fulfilled); // Promise { 1 }
```

#### 2.2.2 `Promise.reject()`

`Promise.reject()` ä¼šå®ä¾‹åŒ–ä¸€ä¸ªæ‹’ç»çš„ promise å¹¶æŠ›å‡ºä¸€ä¸ªå¼‚æ­¥é”™è¯¯ï¼ˆ**è¿™ä¸ªå¼‚æ­¥é”™è¯¯ä¸èƒ½é€šè¿‡`try/catch`æ•è·ï¼Œè€Œåªèƒ½é€šè¿‡æ‹’ç»å¤„ç†ç¨‹åºæ•è·**å³`catch()`æ–¹æ³•ï¼‰

```javascript
const p_reject = Promise.reject(1);
setTimeout(console.log, 0, p_reject); // Promise { <rejected> 1 }
```

#### 2.2.3 `Promise.all()`

`Promise.all()` æ–¹æ³•æ¥æ”¶ä¸€ä¸ª**å¯è¿­ä»£å¯¹è±¡**ï¼Œè¿”å›ä¸€ä¸ª `Promise` å¯¹è±¡ï¼Œä¼šåœ¨è¿™ä¸€ç»„ `Promise` **å…¨éƒ¨è§£å†³ä¹‹åå†è§£å†³**ã€‚

```javascript
const p = Promise.all([Promise.resolve(), Promise.resolve()]);

p.then(() => {
  console.log("Promise.all()");
});
```

#### 2.2.4 `Promise.race()`

`Promise.race()` ä¼šè¿”å›ä¸€ä¸ªåŒ…è£… *promise*ï¼Œæ˜¯ä¸€ç»„é›†åˆä¸­**æœ€å…ˆè§£å†³æˆ–æ‹’ç»**çš„ *promise* çš„é•œåƒã€‚

è¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ *promise*

```javascript
const p_race = Promise.race([
  Promise.resolve(1),
  Promise.reject(2),
  Promise.resolve(3),
]);

setTimeout(console.log, 0, p_race); // Promise { 1 }

p_race.then(data => {
  console.log(data); // 1
});
```

## å››ã€å‚è€ƒ

> å¼•ç”¨ï¼Œ[\*\*\*]()

## äº”ã€æ€»ç»“ & *Last*

å¦‚æœæœ‰ä»»ä½•ç–‘é—®æ¬¢è¿åœ¨è¯„è®ºåŒºå‹å¥½äº¤æµå‘¦ ğŸ˜†ã€‚

- æ¬¢è¿å…³æ³¨æˆ‘å‘¦ ğŸ˜†ï¼Œ[æˆ‘çš„ CSDN åšå®¢ä¸»é¡µ](https://blog.csdn.net/qq_45265059)ã€‚
- è¿˜æœ‰æˆ‘çš„<font face="Hack">Github[@ienyh](https://github.com/ienyh)<font>ä¸€èµ·å­¦ä¹ å“ˆå“ˆå“ˆ ğŸ‘¨â€ğŸ’»
